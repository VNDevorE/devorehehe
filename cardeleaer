warn("Anti AFK ƒëang ch·∫°y...")
game:GetService("Players").LocalPlayer.Idled:Connect(function()
    warn("Anti AFK k√≠ch ho·∫°t - ƒêang gi·∫£ l·∫≠p chu·ªôt ph·∫£i")
    local VirtualUser = game:GetService("VirtualUser")
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Gravity = workspace.Gravity -- 196.2
local MAX_SPEED = 510 
local MAX_FORCE_VECTOR = Vector3.new(math.huge, math.huge, math.huge)

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- T·∫°o GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FlyCarGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 250, 0, 80)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, 0, 0, 30)
titleLabel.BackgroundTransparency = 1
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.Text = "üöó Hennessey3 Fly"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.GothamBold
titleLabel.Parent = mainFrame

local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0.9, 0, 0, 35)
toggleButton.Position = UDim2.new(0.05, 0, 0, 35)
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleButton.Text = "B·∫¨T FLY"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.Gotham
toggleButton.Parent = mainFrame

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 8)
buttonCorner.Parent = toggleButton

-- Bi·∫øn tr·∫°ng th√°i
local flyEnabled = false
local carModel = nil
local primaryPart = nil
local heartbeatConnection = nil
local antiGravForce = nil
local angularVel = nil
local bodyVelocity = nil

-- TIMER AUTO RETURN
local startTime = os.clock()
local RETURN_TIME = 60 * 30 --giay
local RETURN_CFRAME = CFrame.new(
    -0.00124485791, 20013.5488, -13.8987846,
    0.999999821, -0.000596006052, -3.58467355e-06,
    0.000596015481, 0.999992192, 0.00390104786,
    1.25959752e-06, -0.00390104926, 0.999992371
)

-- H√†m setup xe
-- H√†m setup xe (V2: Auto Detect C·∫£i ti·∫øn)
local function setupCar()
    local targetCar = nil
    
    local character = player.Character
    if not character then return false end

    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return false end

    -- LOGIC T√åM XE
    -- 1. ∆Øu ti√™n ki·ªÉm tra Humanoid.SeatPart
    if humanoid.SeatPart then
        warn("Debug: Found SeatPart detected: " .. humanoid.SeatPart.Name)
        local current = humanoid.SeatPart
        -- Leo ng∆∞·ª£c l√™n parent ƒë·ªÉ t√¨m Model xe ch√≠nh
        while current and current ~= workspace and current.Parent ~= game do
             current = current.Parent
             if current:IsA("Model") and current.PrimaryPart then
                 targetCar = current
                 -- N·∫øu Model n√†y n·∫±m trong workspace.Cars th√¨ qu√° chu·∫©n, ch·ªët lu√¥n
                 if current.Parent and current.Parent.Name == "Cars" then
                     break
                 end
             end
        end
    end

    -- 2. Fallback: N·∫øu SeatPart nil (do lag?), qu√©t workspace.Cars t√¨m gh·∫ø m√¨nh ƒëang ng·ªìi
    if not targetCar and workspace:FindFirstChild("Cars") then
        warn("Debug: SeatPart nil, scanning workspace.Cars variants...")
        for _, desc in pairs(workspace.Cars:GetDescendants()) do
            if (desc:IsA("VehicleSeat") or desc:IsA("Seat")) and desc.Occupant == humanoid then
                 warn("Debug: Found occupied seat via scan: " .. desc.Name)
                 -- Leo ng∆∞·ª£c l√™n t√¨m Model
                 local current = desc
                 while current and current ~= workspace and current.Parent ~= game do
                     current = current.Parent
                     if current:IsA("Model") and current.PrimaryPart then
                         targetCar = current
                         if current.Parent and current.Parent.Name == "Cars" then
                             break
                         end
                     end
                 end
                 if targetCar then break end
            end
        end
    end

    -- K·∫æT QU·∫¢
    if targetCar then
        warn("‚úÖ Script ƒë√£ nh·∫≠n di·ªán xe: " .. targetCar.Name)
        local v = targetCar
        carModel = v
        primaryPart = carModel.PrimaryPart

        -- Teleport
        v:SetPrimaryPartCFrame(RETURN_CFRAME)

        local att = primaryPart:FindFirstChild("PhysicsAttachment") or Instance.new("Attachment", primaryPart)
        att.Name = "PhysicsAttachment"

        antiGravForce = primaryPart:FindFirstChild("AntiGravityForce")
        if not antiGravForce then
            antiGravForce = Instance.new("VectorForce")
            antiGravForce.Name = "AntiGravityForce"
            antiGravForce.Attachment0 = att
            antiGravForce.Parent = primaryPart
        end
        local totalMass = primaryPart:GetMass()
        antiGravForce.Force = Vector3.new(0, totalMass * Gravity, 0)

        angularVel = primaryPart:FindFirstChild("ZeroAngularVelocity")
        if not angularVel then
            angularVel = Instance.new("BodyAngularVelocity")
            angularVel.Name = "ZeroAngularVelocity"
            angularVel.maxTorque = MAX_FORCE_VECTOR
            angularVel.P = 20000
            angularVel.Parent = primaryPart
        end
        angularVel.AngularVelocity = Vector3.new(0, 0, 0)

        bodyVelocity = primaryPart:FindFirstChild("ConstantBodyVelocity")
        if not bodyVelocity then
            bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.Name = "ConstantBodyVelocity"
            bodyVelocity.maxForce = MAX_FORCE_VECTOR
            bodyVelocity.Parent = primaryPart
        end

        primaryPart:SetNetworkOwner(player)
        return true
    end

    return false
end

-- H√†m b·∫≠t fly
local function enableFly()
    if not carModel then
        if not setupCar() then
            warn("Kh√¥ng t√¨m th·∫•y xe! H√£y ng·ªìi v√†o gh·∫ø l√°i tr∆∞·ªõc khi b·∫≠t.")
            return
        end
    end

    flyEnabled = true
    toggleButton.Text = "T·∫ÆT FLY"
    toggleButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)

    heartbeatConnection = RunService.Heartbeat:Connect(function()
    	if primaryPart and flyEnabled then
        	local forwardVector = primaryPart.CFrame.LookVector
        	bodyVelocity.Velocity = forwardVector * MAX_SPEED

        	if os.clock() - startTime >= RETURN_TIME then
            
           	 -- RECHECK SAFETY
            	if carModel and carModel.PrimaryPart then
                	carModel:SetPrimaryPartCFrame(RETURN_CFRAME)
               		warn("‚≠ê ƒê√£ auto quay v·ªÅ v·ªã tr√≠ b·∫Øt ƒë·∫ßu!")
           	 	else
                	warn("‚ùå Kh√¥ng th·ªÉ teleport v√¨ PrimaryPart NULL ‚Äî ƒë·ª£i 1 nh·ªãp r·ªìi th·ª≠ l·∫°i‚Ä¶")
            	end

            	startTime = os.clock()
        	end
    	end
	end)


    warn("Fly car ƒë√£ B·∫¨T!")
end

-- H√†m t·∫Øt fly
local function disableFly()
    flyEnabled = false
    if heartbeatConnection then
        heartbeatConnection:Disconnect()
        heartbeatConnection = nil
    end
    if bodyVelocity then
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    end
    toggleButton.Text = "B·∫¨T FLY"
    toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)

    warn("Fly car ƒë√£ T·∫ÆT!")
end

-- S·ª± ki·ªán toggle
toggleButton.MouseButton1Click:Connect(function()
    if flyEnabled then
        disableFly()
    else
        enableFly()
    end
end)

warn("GUI Fly Car ƒë√£ load! Click n√∫t ƒë·ªÉ b·∫≠t/t·∫Øt.")
