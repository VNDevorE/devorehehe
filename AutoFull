-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-- üõ°Ô∏è ANTI AFK SYSTEM
-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
warn("Anti AFK ƒëang ch·∫°y...")
pcall(function()
    game:GetService("Players").LocalPlayer.Idled:Connect(function()
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):ClickButton2(Vector2.new())
    end)
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Gravity = workspace.Gravity -- 196.2
local MAX_SPEED = 510 
local MAX_FORCE_VECTOR = Vector3.new(math.huge, math.huge, math.huge)

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-- üé® MODERN UI DESIGN WITH ANIMATIONS
-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

local scriptStartTime = os.clock()

-- T·∫°o GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FlyCarGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Main Container v·ªõi Gradient Background
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 0, 0, 0) -- Start t·ª´ 0 ƒë·ªÉ animate
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 16)
mainCorner.Parent = mainFrame

-- Gradient Overlay
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 50)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 15, 25))
}
gradient.Rotation = 45
gradient.Parent = mainFrame

-- Glow Effect (Shadow)
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.BackgroundTransparency = 1
shadow.Position = UDim2.new(0, -15, 0, -15)
shadow.Size = UDim2.new(1, 30, 1, 30)
shadow.ZIndex = 0
shadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.7
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(10, 10, 118, 118)
shadow.Parent = mainFrame

-- Header Bar v·ªõi Accent Color
local headerBar = Instance.new("Frame")
headerBar.Name = "HeaderBar"
headerBar.Size = UDim2.new(1, 0, 0, 50)
headerBar.BackgroundColor3 = Color3.fromRGB(138, 43, 226) -- Purple accent
headerBar.BorderSizePixel = 0
headerBar.Parent = mainFrame

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 16)
headerCorner.Parent = headerBar

-- Header Bottom Mask (ƒë·ªÉ ch·ªâ bo g√≥c tr√™n)
local headerMask = Instance.new("Frame")
headerMask.Size = UDim2.new(1, 0, 0, 20)
headerMask.Position = UDim2.new(0, 0, 1, -20)
headerMask.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
headerMask.BorderSizePixel = 0
headerMask.Parent = headerBar

-- Animated Gradient cho Header
local headerGradient = Instance.new("UIGradient")
headerGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(138, 43, 226)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(102, 51, 238)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(138, 43, 226))
}
headerGradient.Parent = headerBar

-- Title Icon
local titleIcon = Instance.new("TextLabel")
titleIcon.Name = "TitleIcon"
titleIcon.Size = UDim2.new(0, 40, 0, 40)
titleIcon.Position = UDim2.new(0, 10, 0, 5)
titleIcon.BackgroundTransparency = 1
titleIcon.Text = "üöó"
titleIcon.TextSize = 28
titleIcon.Font = Enum.Font.GothamBold
titleIcon.Parent = headerBar

-- Title Label
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, -120, 0, 25)
titleLabel.Position = UDim2.new(0, 55, 0, 5)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "VEHICLE FLY"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 18
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = headerBar

-- Subtitle
local subtitle = Instance.new("TextLabel")
subtitle.Name = "Subtitle"
subtitle.Size = UDim2.new(1, -120, 0, 15)
subtitle.Position = UDim2.new(0, 55, 0, 28)
subtitle.BackgroundTransparency = 1
subtitle.Text = "Advanced Flight System"
subtitle.TextColor3 = Color3.fromRGB(200, 200, 220)
subtitle.TextSize = 10
subtitle.Font = Enum.Font.Gotham
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.TextTransparency = 0.3
subtitle.Parent = headerBar

-- Status Indicator (Animated Dot)
local statusDot = Instance.new("Frame")
statusDot.Name = "StatusDot"
statusDot.Size = UDim2.new(0, 8, 0, 8)
statusDot.Position = UDim2.new(1, -18, 0, 21)
statusDot.BackgroundColor3 = Color3.fromRGB(0, 255, 127)
statusDot.BorderSizePixel = 0
statusDot.Parent = headerBar

local dotCorner = Instance.new("UICorner")
dotCorner.CornerRadius = UDim.new(1, 0)
dotCorner.Parent = statusDot

-- Content Container
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -30, 1, -70)
contentFrame.Position = UDim2.new(0, 15, 0, 60)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Info Panel
local infoPanel = Instance.new("Frame")
infoPanel.Name = "InfoPanel"
infoPanel.Size = UDim2.new(1, 0, 0, 60)
infoPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
infoPanel.BorderSizePixel = 0
infoPanel.Parent = contentFrame

local infoPanelCorner = Instance.new("UICorner")
infoPanelCorner.CornerRadius = UDim.new(0, 10)
infoPanelCorner.Parent = infoPanel

-- Speed Label
local speedLabel = Instance.new("TextLabel")
speedLabel.Name = "SpeedLabel"
speedLabel.Size = UDim2.new(0.5, -5, 0, 25)
speedLabel.Position = UDim2.new(0, 10, 0, 5)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "‚ö° Speed"
speedLabel.TextColor3 = Color3.fromRGB(150, 150, 170)
speedLabel.TextSize = 11
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = infoPanel

local speedValue = Instance.new("TextLabel")
speedValue.Name = "SpeedValue"
speedValue.Size = UDim2.new(0.5, -10, 0, 25)
speedValue.Position = UDim2.new(0, 10, 0, 25)
speedValue.BackgroundTransparency = 1
speedValue.Text = "0"
speedValue.TextColor3 = Color3.fromRGB(138, 43, 226)
speedValue.TextSize = 16
speedValue.Font = Enum.Font.GothamBold
speedValue.TextXAlignment = Enum.TextXAlignment.Left
speedValue.Parent = infoPanel

-- Runtime Label
local runtimeLabel = Instance.new("TextLabel")
runtimeLabel.Name = "RuntimeLabel"
runtimeLabel.Size = UDim2.new(0.5, -5, 0, 25)
runtimeLabel.Position = UDim2.new(0.5, 0, 0, 5)
runtimeLabel.BackgroundTransparency = 1
runtimeLabel.Text = "‚è±Ô∏è Runtime"
runtimeLabel.TextColor3 = Color3.fromRGB(150, 150, 170)
runtimeLabel.TextSize = 11
runtimeLabel.Font = Enum.Font.Gotham
runtimeLabel.TextXAlignment = Enum.TextXAlignment.Left
runtimeLabel.Parent = infoPanel

local runtimeValue = Instance.new("TextLabel")
runtimeValue.Name = "RuntimeValue"
runtimeValue.Size = UDim2.new(0.5, -10, 0, 25)
runtimeValue.Position = UDim2.new(0.5, 0, 0, 25)
runtimeValue.BackgroundTransparency = 1
runtimeValue.Text = "00:00:00"
runtimeValue.TextColor3 = Color3.fromRGB(0, 255, 127)
runtimeValue.TextSize = 16
runtimeValue.Font = Enum.Font.GothamBold
runtimeValue.TextXAlignment = Enum.TextXAlignment.Left
runtimeValue.Parent = infoPanel

-- Toggle Button v·ªõi Gradient
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(1, 0, 0, 50)
toggleButton.Position = UDim2.new(0, 0, 0, 70)
toggleButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
toggleButton.BorderSizePixel = 0
toggleButton.AutoButtonColor = false
toggleButton.Text = ""
toggleButton.Parent = contentFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 12)
toggleCorner.Parent = toggleButton

local toggleGradient = Instance.new("UIGradient")
toggleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 53, 69)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(185, 28, 28))
}
toggleGradient.Rotation = 90
toggleGradient.Parent = toggleButton

-- Button Icon
local buttonIcon = Instance.new("TextLabel")
buttonIcon.Name = "ButtonIcon"
buttonIcon.Size = UDim2.new(0, 30, 1, 0)
buttonIcon.Position = UDim2.new(0, 10, 0, 0)
buttonIcon.BackgroundTransparency = 1
buttonIcon.Text = "‚ñ∂"
buttonIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
buttonIcon.TextSize = 20
buttonIcon.Font = Enum.Font.GothamBold
buttonIcon.Parent = toggleButton

-- Button Text
local buttonText = Instance.new("TextLabel")
buttonText.Name = "ButtonText"
buttonText.Size = UDim2.new(1, -50, 1, 0)
buttonText.Position = UDim2.new(0, 45, 0, 0)
buttonText.BackgroundTransparency = 1
buttonText.Text = "ACTIVATE FLY"
buttonText.TextColor3 = Color3.fromRGB(255, 255, 255)
buttonText.TextSize = 16
buttonText.Font = Enum.Font.GothamBold
buttonText.TextXAlignment = Enum.TextXAlignment.Left
buttonText.Parent = toggleButton

-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-- üé¨ ANIMATIONS
-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

-- Entrance Animation
mainFrame:TweenSize(
    UDim2.new(0, 320, 0, 200),
    Enum.EasingDirection.Out,
    Enum.EasingStyle.Back,
    0.6,
    true
)

-- Pulsing Status Dot Animation
spawn(function()
    while wait(1) do
        statusDot:TweenSize(UDim2.new(0, 12, 0, 12), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.5, true)
        wait(0.5)
        statusDot:TweenSize(UDim2.new(0, 8, 0, 8), Enum.EasingDirection.In, Enum.EasingStyle.Quad, 0.5, true)
    end
end)

-- Gradient Animation cho Header
spawn(function()
    while wait() do
        for i = 0, 360, 2 do
            headerGradient.Rotation = i
            wait(0.03)
        end
    end
end)

-- Runtime Timer Update
spawn(function()
    while wait(1) do
        local elapsed = os.clock() - scriptStartTime
        local hours = math.floor(elapsed / 3600)
        local minutes = math.floor((elapsed % 3600) / 60)
        local seconds = math.floor(elapsed % 60)
        runtimeValue.Text = string.format("%02d:%02d:%02d", hours, minutes, seconds)
    end
end)

-- Bi·∫øn tr·∫°ng th√°i
local flyEnabled = false
local carModel = nil
local primaryPart = nil
local heartbeatConnection = nil
local antiGravForce = nil
local angularVel = nil
local bodyVelocity = nil
local vehicleSeat = nil  -- Kh·ªüi t·∫°o bi·∫øn gh·∫ø l√°i
local currentSpeed = 0   -- Kh·ªüi t·∫°o t·ªëc ƒë·ªô hi·ªán t·∫°i

-- TIMER AUTO RETURN
local startTime = os.clock()
local RETURN_TIME = 60 * 30 --giay
local RETURN_CFRAME = CFrame.new(
    -0.00124485791, 20013.5488, -13.8987846,
    0.999999821, -0.000596006052, -3.58467355e-06,
    0.000596015481, 0.999992192, 0.00390104786,
    1.25959752e-06, -0.00390104926, 0.999992371
)

-- H√†m setup xe
-- H√†m setup xe (V2: Auto Detect C·∫£i ti·∫øn)
local function setupCar()
    local targetCar = nil
    
    local character = player.Character
    if not character then return false end

    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return false end

    -- LOGIC T√åM XE
    -- 1. ∆Øu ti√™n ki·ªÉm tra Humanoid.SeatPart
    if humanoid.SeatPart then
        warn("Debug: Found SeatPart detected: " .. humanoid.SeatPart.Name)
        local current = humanoid.SeatPart
        -- Leo ng∆∞·ª£c l√™n parent ƒë·ªÉ t√¨m Model xe ch√≠nh
        while current and current ~= workspace and current.Parent ~= game do
             current = current.Parent
             if current:IsA("Model") and current.PrimaryPart then
                 targetCar = current
                 -- N·∫øu Model n√†y n·∫±m trong workspace.Cars th√¨ qu√° chu·∫©n, ch·ªët lu√¥n
                 if current.Parent and current.Parent.Name == "Cars" then
                     break
                 end
             end
        end
    end

    -- 2. Fallback: N·∫øu SeatPart nil (do lag?), qu√©t workspace.Cars t√¨m gh·∫ø m√¨nh ƒëang ng·ªìi
    if not targetCar and workspace:FindFirstChild("Cars") then
        warn("Debug: SeatPart nil, scanning workspace.Cars variants...")
        for _, desc in pairs(workspace.Cars:GetDescendants()) do
            if (desc:IsA("VehicleSeat") or desc:IsA("Seat")) and desc.Occupant == humanoid then
                 warn("Debug: Found occupied seat via scan: " .. desc.Name)
                 vehicleSeat = desc -- G√°n gh·∫ø xe v√†o bi·∫øn to√†n c·ª•c
                 -- Leo ng∆∞·ª£c l√™n t√¨m Model
                 local current = desc
                 while current and current ~= workspace and current.Parent ~= game do
                     current = current.Parent
                     if current:IsA("Model") and current.PrimaryPart then
                         targetCar = current
                         if current.Parent and current.Parent.Name == "Cars" then
                             break
                         end
                     end
                 end
                 if targetCar then break end
            end
        end
    end

    -- K·∫æT QU·∫¢
    if targetCar then
        warn("‚úÖ Script ƒë√£ nh·∫≠n di·ªán xe: " .. targetCar.Name)
        local v = targetCar
        carModel = v
        primaryPart = carModel.PrimaryPart
        if not vehicleSeat then
            vehicleSeat = v:FindFirstChildWhichIsA("VehicleSeat", true)
        end

        -- Teleport
        v:SetPrimaryPartCFrame(RETURN_CFRAME)

        local att = primaryPart:FindFirstChild("PhysicsAttachment") or Instance.new("Attachment", primaryPart)
        att.Name = "PhysicsAttachment"

        antiGravForce = primaryPart:FindFirstChild("AntiGravityForce")
        if not antiGravForce then
            antiGravForce = Instance.new("VectorForce")
            antiGravForce.Name = "AntiGravityForce"
            antiGravForce.Attachment0 = att
            antiGravForce.Parent = primaryPart
        end
        local totalMass = primaryPart:GetMass()
        antiGravForce.Force = Vector3.new(0, totalMass * Gravity, 0)

        angularVel = primaryPart:FindFirstChild("ZeroAngularVelocity")
        if not angularVel then
            angularVel = Instance.new("BodyAngularVelocity")
            angularVel.Name = "ZeroAngularVelocity"
            angularVel.maxTorque = MAX_FORCE_VECTOR
            angularVel.P = 20000
            angularVel.Parent = primaryPart
        end
        angularVel.AngularVelocity = Vector3.new(0, 0, 0)

        bodyVelocity = primaryPart:FindFirstChild("ConstantBodyVelocity")
        if not bodyVelocity then
            bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.Name = "ConstantBodyVelocity"
            bodyVelocity.maxForce = MAX_FORCE_VECTOR
            bodyVelocity.Parent = primaryPart
        end

        -- Try to set network owner (s·∫Ω fail n·∫øu ch·∫°y t·ª´ client, nh∆∞ng kh√¥ng sao)
        pcall(function()
            primaryPart:SetNetworkOwner(player)
        end)
        return true
    end

    return false
end

-- H√†m b·∫≠t fly
local function enableFly()
    -- N·∫øu ƒë√£ ƒëang bay (c√≥ carModel v√† primaryPart), kh√¥ng c·∫ßn setup l·∫°i
    -- Ch·ªâ setup khi ch∆∞a c√≥ xe ho·∫∑c xe b·ªã m·∫•t
    if not carModel or not primaryPart then
        if not setupCar() then
            warn("Kh√¥ng t√¨m th·∫•y xe! H√£y ng·ªìi v√†o gh·∫ø l√°i tr∆∞·ªõc khi b·∫≠t.")
            return
        end
    end

    flyEnabled = true
    
    -- UI Updates v·ªõi Animation
    buttonText.Text = "DEACTIVATE FLY"
    buttonIcon.Text = "‚è∏"
    
    toggleGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(34, 197, 94)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(22, 163, 74))
    }
    
    -- Status dot color change
    statusDot.BackgroundColor3 = Color3.fromRGB(34, 197, 94)

    -- Kh·ªüi t·∫°o t·ªëc ƒë·ªô ngay khi b·∫≠t
    currentSpeed = MAX_SPEED

    heartbeatConnection = RunService.Heartbeat:Connect(function()
    	if primaryPart and flyEnabled then
            -- X·ª≠ l√Ω tƒÉng gi·∫£m t·ªëc ƒë·ªô (AUTO W MODE)
            local isS = game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S)
            
            local targetSpeed = MAX_SPEED -- M·∫∑c ƒë·ªãnh lao v·ªÅ ph√≠a tr∆∞·ªõc (Auto W)
            
            if isS then
                targetSpeed = -MAX_SPEED / 2 -- Phanh / L√πi
            end
            
            -- Gi·∫£ l·∫≠p Throttle ƒë·ªÉ game nh·∫≠n di·ªán xe ƒëang ch·∫°y
            if vehicleSeat then
                if isS then
                    vehicleSeat.Throttle = -1
                    vehicleSeat.ThrottleFloat = -1
                else
                    vehicleSeat.Throttle = 1
                    vehicleSeat.ThrottleFloat = 1
                end
            end

            -- G√°n t·ªëc ƒë·ªô tr·ª±c ti·∫øp (kh√¥ng c√≥ gia t·ªëc t·ª´ t·ª´)
            currentSpeed = targetSpeed

        	local forwardVector = primaryPart.CFrame.LookVector
        	bodyVelocity.Velocity = forwardVector * currentSpeed
            
            -- Update Speed Display
            speedValue.Text = math.floor(math.abs(currentSpeed))

        	if os.clock() - startTime >= RETURN_TIME then
            	if carModel and carModel.PrimaryPart then
                	carModel:SetPrimaryPartCFrame(RETURN_CFRAME)
               		warn("‚≠ê ƒê√£ auto quay v·ªÅ v·ªã tr√≠ b·∫Øt ƒë·∫ßu!")
           	 	else
                	warn("‚ùå Kh√¥ng th·ªÉ teleport v√¨ PrimaryPart NULL ‚Äî ƒë·ª£i 1 nh·ªãp r·ªìi th·ª≠ l·∫°i‚Ä¶")
            	end
            	startTime = os.clock()
        	end
    	end
	end)

    warn("Fly car ƒë√£ B·∫¨T!")
end

-- H√†m t·∫Øt fly
local function disableFly()
    flyEnabled = false
    if heartbeatConnection then
        heartbeatConnection:Disconnect()
        heartbeatConnection = nil
    end
    if bodyVelocity then
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    end
    
    -- Reset t·∫•t c·∫£ bi·∫øn state ƒë·ªÉ l·∫ßn sau b·∫≠t l·∫°i s·∫Ω setup t·ª´ ƒë·∫ßu
    carModel = nil
    primaryPart = nil
    vehicleSeat = nil
    
    -- UI Updates v·ªõi Animation
    buttonText.Text = "ACTIVATE FLY"
    buttonIcon.Text = "‚ñ∂"
    
    toggleGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 53, 69)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(185, 28, 28))
    }
    
    -- Status dot color change
    statusDot.BackgroundColor3 = Color3.fromRGB(0, 255, 127)
    
    -- Reset speed display
    currentSpeed = 0
    speedValue.Text = "0"

    warn("Fly car ƒë√£ T·∫ÆT!")
end

-- S·ª± ki·ªán toggle v·ªõi Hover Effect
toggleButton.MouseEnter:Connect(function()
    if not flyEnabled then
        toggleButton:TweenSize(UDim2.new(1, 5, 0, 52), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
    end
end)

toggleButton.MouseLeave:Connect(function()
    toggleButton:TweenSize(UDim2.new(1, 0, 0, 50), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
end)

toggleButton.MouseButton1Click:Connect(function()
    -- Click Animation
    toggleButton:TweenSize(UDim2.new(1, -5, 0, 48), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.1, true)
    wait(0.1)
    toggleButton:TweenSize(UDim2.new(1, 0, 0, 50), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.1, true)
    
    if flyEnabled then
        disableFly()
    else
        enableFly()
    end
end)

warn("‚ú® GUI Fly Car ƒë√£ load v·ªõi UI hi·ªán ƒë·∫°i! Click n√∫t ƒë·ªÉ b·∫≠t/t·∫Øt.")

-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-- ü§ñ H·ªÜ TH·ªêNG T·ª∞ ƒê·ªòNG (ƒê√É CHUY·ªÇN XU·ªêNG CU·ªêI ƒê·ªÇ K·∫æT N·ªêI V·ªöI FLY)
-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
task.spawn(function()
    -- C·∫§U H√åNH
    local targetDealership = "HyperDealership" 
    local targetCarName = "Hanessy Poison Rebel Speedster"
    
    warn("üöÄ [AUTO] B·∫Øt ƒë·∫ßu quy tr√¨nh t·ª± ƒë·ªông l·∫•y xe...")
    task.wait(10) -- ƒê·ª£i game load

    -- B∆Ø·ªöC 1: CH·ªåN ƒê·∫†I L√ù
    local foundChoose = false
    repeat
        local intro = playerGui:FindFirstChild("Intro", true)
        local chooseMenu = playerGui:FindFirstChild("ChooseDealership", true) or (intro and intro:FindFirstChild("ChooseDealership", true))
        local scroll = chooseMenu and chooseMenu:FindFirstChild("ScrollingFrame", true)
        local targetFrame = scroll and scroll:FindFirstChild(targetDealership)
        local btn = targetFrame and targetFrame:FindFirstChild("Choose")

        if btn and btn.Visible then
            warn("1Ô∏è‚É£ [AUTO] Ch·ªçn ƒë·∫°i l√Ω: " .. targetDealership)
            if firesignal then firesignal(btn.Activated) end
            pcall(function() require(ReplicatedStorage.Packages.Net):Invoke("Dealership.PurchaseDealership", targetDealership) end)
            foundChoose = true
        end
        task.wait(1)
    until foundChoose

    -- B∆Ø·ªöC 2: NH·∫§N LOAD PLOT
    local foundLoad = false
    warn("2Ô∏è‚É£ [AUTO] ƒêang t√¨m n√∫t LOAD...")
    while not foundLoad do
        for _, v in pairs(playerGui:GetDescendants()) do
            if (v:IsA("TextButton") or v:IsA("TextLabel")) and v.Text == "LOAD" then
                local btn = v:IsA("GuiButton") and v or v.Parent
                if btn and btn:IsA("GuiButton") and btn.Visible and btn.AbsoluteSize.X > 0 then
                    warn("‚úÖ ƒê√£ nh·∫•n LOAD!")
                    if firesignal then firesignal(btn.Activated) end
                    foundLoad = true; break
                end
            end
        end
        task.wait(0.5)
    end

    -- B∆Ø·ªöC 3: M·ªû KHO XE
    task.wait(13) -- ƒê·ª£i x√¢y nh√†
    warn("3Ô∏è‚É£ [AUTO] M·ªü Inventory...")
    local foundInventory = false
    while not foundInventory do
        local menu = playerGui:FindFirstChild("Menu")
        local buttons = menu and menu:FindFirstChild("Buttons")
        local invBtn = buttons and buttons:FindFirstChild("Inventory")
        
        if invBtn and invBtn:IsA("ImageButton") and invBtn.Visible then
            if firesignal then 
                firesignal(invBtn.Activated)
                firesignal(invBtn.MouseButton1Click)
            end
            foundInventory = true
        end
        task.wait(1)
    end

    -- B∆Ø·ªöC 4: CH·ªåN XE & DRIVE -> K√çCH HO·∫†T FLY
    task.wait(2)
    warn("4Ô∏è‚É£ [AUTO] Ch·ªçn xe: " .. targetCarName)
    local carSelected, driveClicked = false, false

    while not driveClicked do
        for _, v in pairs(playerGui:GetDescendants()) do
            -- 4.1: Ch·ªçn xe trong list
            if not carSelected and v:IsA("TextLabel") and v.Text == targetCarName then
                local carBtn = v:IsA("GuiButton") and v or v.Parent
                if carBtn and carBtn.Visible then
                    if firesignal then firesignal(carBtn.Activated) end
                    carSelected = true
                    task.wait(1.5) 
                end
            end

            -- 4.2: Nh·∫•n DRIVE v√† K√çCH HO·∫†T FLY
            if carSelected then
                if v.Name == "Spawn" and v:IsA("ImageButton") and v.Parent.Name == "2" then
                    if v.Visible and v.AbsoluteSize.X > 0 then
                        warn("üöô ƒê√£ t√¨m th·∫•y n√∫t DRIVE! ƒêang click...")
                        
                        -- Click n√∫t Drive
                        if firesignal then
                            firesignal(v.Activated)
                            firesignal(v.MouseButton1Click)
                        end
                        pcall(function()
                            for _, con in pairs(getconnections(v.Activated)) do con:Fire() end
                        end)
                        
                        driveClicked = true
                        
                        -- PH·∫¶N QUAN TR·ªåNG NH·∫§T: AUTO ACTIVE FLY
                        warn("‚è≥ ƒê·ª£i 2 gi√¢y ƒë·ªÉ nh√¢n v·∫≠t ng·ªìi v√†o gh·∫ø...")
                        task.wait(2.5) -- ƒê·ª£i server x·∫øp nh√¢n v·∫≠t v√†o gh·∫ø
                        
                        warn("üöÄ K√çCH HO·∫†T ACTIVE FLY T·ª∞ ƒê·ªòNG!")
                        
                        -- Th·ª≠ k√≠ch ho·∫°t Fly (l·∫∑p l·∫°i v√†i l·∫ßn ƒë·ªÉ ch·∫Øc ch·∫Øn nh·∫≠n di·ªán ƒë∆∞·ª£c xe)
                        for i = 1, 5 do
                            -- G·ªçi h√†m setupCar() ƒë·ªÉ check xem ƒë√£ ng·ªìi gh·∫ø ch∆∞a
                            if setupCar() then
                                enableFly() -- G·ªçi h√†m b·∫≠t bay c·ªßa UI
                                warn("‚úÖ AUTO SUCCESS: ƒê√£ bay l√™n tr·ªùi!")
                                break
                            else
                                warn("‚ö†Ô∏è Ch∆∞a nh·∫≠n di·ªán ƒë∆∞·ª£c gh·∫ø, th·ª≠ l·∫°i sau 1s...")
                            end
                            task.wait(1)
                        end
                        
                        break -- Tho√°t v√≤ng l·∫∑p
                    end
                end
            end
        end
        task.wait(1)
    end
end)
